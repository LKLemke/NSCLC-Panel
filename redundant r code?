# OS By Drug and Stage at Diagnosis

os_drug_stage_pem1 <- merge(pemetrexed, stage,
                            by = "sample")

os_drug_stage_pem <- na.omit(os_drug_stage_pem1)

os_drug_stage_pac1 <- merge(paclitaxel, stage,
                            by = "sample")
os_drug_stage_pac <- na.omit(os_drug_stage_pac1)

os_drug_stage_cis1 <- merge(cisplatin, stage,
                            by = "sample")
os_drug_stage_cis <- na.omit(os_drug_stage_cis1)

os_drug_stage_carb1 <- merge(carboplatin, stage,
                             by = "sample")
os_drug_stage_carb <- na.omit(os_drug_stage_carb1)

os_drug_stage_erl1 <- merge(erlotinib, stage,
                            by = "sample")
os_drug_stage_erl <- na.omit(os_drug_stage_erl1)


os_drug_stage_pem_survival <- survdiff(Surv(os_drug_stage_pem$X_TIME_TO_EVENT, os_drug_stage_pem$X_EVENT)
                                       ~ as.factor(os_drug_stage_pem$tumor_stage.diagnoses))
os_drug_stage_pem_survival

os_drug_stage_pac_survival <- survdiff(Surv(os_drug_stage_pac$X_TIME_TO_EVENT, os_drug_stage_pac$X_EVENT)
                                       ~ as.factor(os_drug_stage_pac$tumor_stage.diagnoses))
os_drug_stage_pac_survival

os_drug_stage_cis_survival <- survdiff(Surv(os_drug_stage_cis$X_TIME_TO_EVENT, os_drug_stage_cis$X_EVENT)
                                       ~ as.factor(os_drug_stage_cis$tumor_stage.diagnoses))
os_drug_stage_cis_survival

os_drug_stage_carb_survival <- survdiff(Surv(os_drug_stage_carb$X_TIME_TO_EVENT, os_drug_stage_carb$X_EVENT)
                                        ~ as.factor(os_drug_stage_carb$tumor_stage.diagnoses))
os_drug_stage_carb_survival

os_drug_stage_erl_survival <- survdiff(Surv(os_drug_stage_erl$X_TIME_TO_EVENT, os_drug_stage_erl$X_EVENT)
                                       ~ as.factor(os_drug_stage_erl$tumor_stage.diagnoses))
os_drug_stage_erl_survival

##Survdiff more complicated...

os_stage_pem <- os_stage1[c(os_stage1$drug_name =="Pemetrexed"), ]
os_stage_pac <- os_stage1[c(os_stage1$drug_name =="Paclitaxel"), ]
os_stage_cis <- os_stage1[c(os_stage1$drug_name =="Cisplatin"), ]
os_stage_carb <- os_stage1[c(os_stage1$drug_name =="Carboplatin"), ]
os_stage_erl <- os_stage1[c(os_stage1$drug_name =="Erlotinib"), ]

os_stage <- rbind(os_stage_pem, os_stage_pac, os_stage_cis, os_stage_carb, os_stage_erl)
dim(os_stage)

# OS for Stage i and Drug

os_stage_i <- os_stage[c(os_stage$tumor_stage.diagnoses == "stage i"), ]

os_stage_i_survival <- survdiff(Surv(os_stage_i$X_TIME_TO_EVENT, 
                                     os_stage_i$X_EVENT) ~ as.factor(os_stage_i$drug_name))

os_stage_i_survival

# OS for Stage ii and Drug

os_stage_ii <- os_stage[c(os_stage$tumor_stage.diagnoses == "stage ii"), ]

os_stage_ii_survival <- survdiff(Surv(os_stage_ii$X_TIME_TO_EVENT, 
                                      os_stage_ii$X_EVENT) ~ as.factor(os_stage_ii$drug_name))

os_stage_ii_survival

# OS for Stage iii and Drug

os_stage_iii <- os_stage[c(os_stage$tumor_stage.diagnoses == "stage iii"), ]

os_stage_iii_survival <- survdiff(Surv(os_stage_iii$X_TIME_TO_EVENT, 
                                       os_stage_iii$X_EVENT) ~ as.factor(os_stage_iii$drug_name))

os_stage_iii_survival

# OS for Stage iv and Drug

os_stage_iv <- os_stage[c(os_stage$tumor_stage.diagnoses == "stage iv"), ]

os_stage_iv_survival <- survdiff(Surv(os_stage_iv$X_TIME_TO_EVENT, 
                                      os_stage_iv$X_EVENT) ~ as.factor(os_stage_iv$drug_name))

os_stage_iv_survival


nt_stage2 <- merge(dat4, stage,
                   by = "sample")
nt_stage1 <- na.omit(nt_stage2)

nt_stage_pem <- nt_stage1[c(nt_stage1$drug_name =="Pemetrexed"), ]
nt_stage_pac <- nt_stage1[c(nt_stage1$drug_name =="Paclitaxel"), ]
nt_stage_cis <- nt_stage1[c(nt_stage1$drug_name =="Cisplatin"), ]
nt_stage_carb <- nt_stage1[c(nt_stage1$drug_name =="Carboplatin"), ]
nt_stage_erl <- nt_stage1[c(nt_stage1$drug_name =="Erlotinib"), ]

nt_stage <- rbind(nt_stage_pem, nt_stage_pac, nt_stage_cis, nt_stage_carb, nt_stage_erl)

nt_stagei <- nt_stage[c(nt_stage$tumor_stage.diagnoses == "stage i"), ]
nt_stageii <- nt_stage[c(nt_stage$tumor_stage.diagnoses == "stage ii"), ]
nt_stageiii <- nt_stage[c(nt_stage$tumor_stage.diagnoses == "stage iii"), ]
nt_stageiv <- nt_stage[c(nt_stage$tumor_stage.diagnoses == "stage iv"), ]

# Stage i
stagei_nt_survival <- survfit(Surv(nt_stagei$days_to_new_tumor_event_after_initial_treatment,
                                   nt_stagei$new_tumor_event_after_initial_treatment) ~ 1)
summary(stagei_nt_survival)                 
plot(stagei_nt_survival, main="Months to New Tumor Event for Stage i ", xlab="Months", ylab="New Tumor Event")

# Stage ii
stageii_nt_survival <- survfit(Surv(nt_stageii$days_to_new_tumor_event_after_initial_treatment,
                                    nt_stageii$new_tumor_event_after_initial_treatment) ~ 1)
summary(stageii_nt_survival)                 
plot(stageii_nt_survival, main="Months to New Tumor Event for Stage ii ", xlab="Months", ylab="New Tumor Event")

# Stage iii
stageiii_nt_survival <- survfit(Surv(nt_stageiii$days_to_new_tumor_event_after_initial_treatment,
                                     nt_stageiii$new_tumor_event_after_initial_treatment) ~ 1)
summary(stageiii_nt_survival)                 
plot(stageiii_nt_survival, main="Months to New Tumor Event for Stage iii", xlab="Months", ylab="New Tumor Event")

# Stage iv
stageiv_nt_survival <- survfit(Surv(nt_stageiv$days_to_new_tumor_event_after_initial_treatment,
                                    nt_stageiv$new_tumor_event_after_initial_treatment) ~ 1)
summary(stageiv_nt_survival)                 
plot(stageiv_nt_survival, main="Months to New Tumor Event for Stage iv", xlab="Months", ylab="New Tumor Event")


nt_survival_stage <- survdiff(Surv(nt_stage$days_to_new_tumor_event_after_initial_treatment,
                                   nt_stage$new_tumor_event_after_initial_treatment)
                              ~ nt_stage$tumor_stage.diagnoses)
nt_survival_stage

# New Tumor Survival Analysis By Drug and Stage

nt_survival_stage_drug <- survdiff(Surv(nt_stage$days_to_new_tumor_event_after_initial_treatment,
                                        nt_stage$new_tumor_event_after_initial_treatment)
                                   ~ nt_stage$tumor_stage.diagnoses + nt_stage$drug_name)

nt_survival_stage_drug
